"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.emitAvailableInfo = void 0;
const get_audio_codec_1 = require("./get-audio-codec");
const get_container_1 = require("./get-container");
const get_dimensions_1 = require("./get-dimensions");
const get_duration_1 = require("./get-duration");
const get_fps_1 = require("./get-fps");
const get_is_hdr_1 = require("./get-is-hdr");
const get_keyframes_1 = require("./get-keyframes");
const get_location_1 = require("./get-location");
const get_number_of_audio_channels_1 = require("./get-number-of-audio-channels");
const get_sample_rate_1 = require("./get-sample-rate");
const get_tracks_1 = require("./get-tracks");
const get_video_codec_1 = require("./get-video-codec");
const get_metadata_1 = require("./metadata/get-metadata");
const emitAvailableInfo = async ({ hasInfo, callbacks, state, returnValue, name, mimeType, fieldsInReturnValue, }) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4;
    const keys = Object.keys(hasInfo);
    const { emittedFields } = state;
    for (const key of keys) {
        if (key === 'structure') {
            if (hasInfo.structure && !emittedFields.structure) {
                await ((_a = callbacks.onStructure) === null || _a === void 0 ? void 0 : _a.call(callbacks, state.getStructure()));
                if (fieldsInReturnValue.structure) {
                    returnValue.structure = state.getStructure();
                }
                emittedFields.structure = true;
            }
            continue;
        }
        if (key === 'durationInSeconds') {
            if (hasInfo.durationInSeconds) {
                if (!emittedFields.durationInSeconds) {
                    const durationInSeconds = (0, get_duration_1.getDuration)(state);
                    await ((_b = callbacks.onDurationInSeconds) === null || _b === void 0 ? void 0 : _b.call(callbacks, durationInSeconds));
                    if (fieldsInReturnValue.durationInSeconds) {
                        returnValue.durationInSeconds = durationInSeconds;
                    }
                    emittedFields.durationInSeconds = true;
                }
            }
            continue;
        }
        if (key === 'slowDurationInSeconds') {
            if (hasInfo.slowDurationInSeconds &&
                !emittedFields.slowDurationInSeconds) {
                const slowDurationInSeconds = (_c = (0, get_duration_1.getDuration)(state)) !== null && _c !== void 0 ? _c : state.slowDurationAndFps.getSlowDurationInSeconds();
                await ((_d = callbacks.onSlowDurationInSeconds) === null || _d === void 0 ? void 0 : _d.call(callbacks, slowDurationInSeconds));
                if (fieldsInReturnValue.slowDurationInSeconds) {
                    returnValue.slowDurationInSeconds = slowDurationInSeconds;
                }
                emittedFields.slowDurationInSeconds = true;
            }
            continue;
        }
        if (key === 'fps') {
            if (hasInfo.fps) {
                if (!emittedFields.fps) {
                    const fps = (0, get_fps_1.getFps)(state);
                    await ((_e = callbacks.onFps) === null || _e === void 0 ? void 0 : _e.call(callbacks, fps));
                    if (fieldsInReturnValue.fps) {
                        returnValue.fps = fps;
                    }
                    emittedFields.fps = true;
                }
                if (!emittedFields.slowFps) {
                    const fps = (0, get_fps_1.getFps)(state);
                    if (fps) {
                        await ((_f = callbacks.onSlowFps) === null || _f === void 0 ? void 0 : _f.call(callbacks, fps));
                        if (fieldsInReturnValue.slowFps) {
                            returnValue.slowFps = fps;
                        }
                        emittedFields.slowFps = true;
                    }
                }
            }
            continue;
        }
        // must be handled after fps
        if (key === 'slowFps') {
            if (hasInfo.slowFps && !emittedFields.slowFps) {
                const slowFps = state.slowDurationAndFps.getFps();
                await ((_g = callbacks.onSlowFps) === null || _g === void 0 ? void 0 : _g.call(callbacks, slowFps));
                if (fieldsInReturnValue.slowFps) {
                    returnValue.slowFps = slowFps;
                }
                emittedFields.slowFps = true;
            }
            continue;
        }
        if (key === 'dimensions') {
            if (hasInfo.dimensions && !emittedFields.dimensions) {
                const dimensionsQueried = (0, get_dimensions_1.getDimensions)(state);
                const dimensions = dimensionsQueried === null
                    ? null
                    : {
                        height: dimensionsQueried.height,
                        width: dimensionsQueried.width,
                    };
                await ((_h = callbacks.onDimensions) === null || _h === void 0 ? void 0 : _h.call(callbacks, dimensions));
                if (fieldsInReturnValue.dimensions) {
                    returnValue.dimensions = dimensions;
                }
                emittedFields.dimensions = true;
            }
            continue;
        }
        if (key === 'unrotatedDimensions') {
            if (hasInfo.unrotatedDimensions && !emittedFields.unrotatedDimensions) {
                const dimensionsQueried = (0, get_dimensions_1.getDimensions)(state);
                const unrotatedDimensions = dimensionsQueried === null
                    ? null
                    : {
                        height: dimensionsQueried.unrotatedHeight,
                        width: dimensionsQueried.unrotatedWidth,
                    };
                await ((_j = callbacks.onUnrotatedDimensions) === null || _j === void 0 ? void 0 : _j.call(callbacks, unrotatedDimensions));
                if (fieldsInReturnValue.unrotatedDimensions) {
                    returnValue.unrotatedDimensions = unrotatedDimensions;
                }
                emittedFields.unrotatedDimensions = true;
            }
            continue;
        }
        if (key === 'rotation') {
            if (hasInfo.rotation && !emittedFields.rotation) {
                const dimensionsQueried = (0, get_dimensions_1.getDimensions)(state);
                const rotation = (_k = dimensionsQueried === null || dimensionsQueried === void 0 ? void 0 : dimensionsQueried.rotation) !== null && _k !== void 0 ? _k : 0;
                await ((_l = callbacks.onRotation) === null || _l === void 0 ? void 0 : _l.call(callbacks, rotation));
                if (fieldsInReturnValue.rotation) {
                    returnValue.rotation = rotation;
                }
                emittedFields.rotation = true;
            }
            continue;
        }
        if (key === 'videoCodec') {
            if (!emittedFields.videoCodec && hasInfo.videoCodec) {
                const videoCodec = (0, get_video_codec_1.getVideoCodec)(state);
                await ((_m = callbacks.onVideoCodec) === null || _m === void 0 ? void 0 : _m.call(callbacks, videoCodec));
                if (fieldsInReturnValue.videoCodec) {
                    returnValue.videoCodec = videoCodec;
                }
                emittedFields.videoCodec = true;
            }
            continue;
        }
        if (key === 'audioCodec') {
            if (!emittedFields.audioCodec && hasInfo.audioCodec) {
                const audioCodec = (0, get_audio_codec_1.getAudioCodec)(state);
                await ((_o = callbacks.onAudioCodec) === null || _o === void 0 ? void 0 : _o.call(callbacks, audioCodec));
                if (fieldsInReturnValue.audioCodec) {
                    returnValue.audioCodec = audioCodec;
                }
                emittedFields.audioCodec = true;
            }
            continue;
        }
        if (key === 'tracks') {
            if (!emittedFields.tracks && hasInfo.tracks) {
                const { videoTracks, audioTracks } = (0, get_tracks_1.getTracks)(state);
                await ((_p = callbacks.onTracks) === null || _p === void 0 ? void 0 : _p.call(callbacks, { videoTracks, audioTracks }));
                if (fieldsInReturnValue.tracks) {
                    returnValue.tracks = { videoTracks, audioTracks };
                }
                emittedFields.tracks = true;
            }
            continue;
        }
        if (key === 'internalStats') {
            // Special case: Always emitting internal stats at the end
            if (hasInfo.internalStats) {
                const internalStats = state.getInternalStats();
                if (fieldsInReturnValue.internalStats) {
                    returnValue.internalStats = internalStats;
                }
                emittedFields.internalStats = true;
            }
            continue;
        }
        if (key === 'size') {
            if (!emittedFields.size && hasInfo.size) {
                await ((_q = callbacks.onSize) === null || _q === void 0 ? void 0 : _q.call(callbacks, state.contentLength));
                if (fieldsInReturnValue.size) {
                    returnValue.size = state.contentLength;
                }
                emittedFields.size = true;
            }
            continue;
        }
        if (key === 'mimeType') {
            if (!emittedFields.mimeType && hasInfo.mimeType) {
                await ((_r = callbacks.onMimeType) === null || _r === void 0 ? void 0 : _r.call(callbacks, mimeType));
                if (fieldsInReturnValue.mimeType) {
                    returnValue.mimeType = mimeType;
                }
                emittedFields.mimeType = true;
            }
            continue;
        }
        if (key === 'name') {
            if (!emittedFields.name && hasInfo.name) {
                await ((_s = callbacks.onName) === null || _s === void 0 ? void 0 : _s.call(callbacks, name));
                if (fieldsInReturnValue.name) {
                    returnValue.name = name;
                }
                emittedFields.name = true;
            }
            continue;
        }
        if (key === 'isHdr') {
            if (!returnValue.isHdr && hasInfo.isHdr) {
                const isHdr = (0, get_is_hdr_1.getIsHdr)(state);
                await ((_t = callbacks.onIsHdr) === null || _t === void 0 ? void 0 : _t.call(callbacks, isHdr));
                if (fieldsInReturnValue.isHdr) {
                    returnValue.isHdr = isHdr;
                }
                emittedFields.isHdr = true;
            }
            continue;
        }
        if (key === 'container') {
            if (!returnValue.container && hasInfo.container) {
                const container = (0, get_container_1.getContainer)(state.getStructure());
                await ((_u = callbacks.onContainer) === null || _u === void 0 ? void 0 : _u.call(callbacks, container));
                if (fieldsInReturnValue.container) {
                    returnValue.container = container;
                }
                emittedFields.container = true;
            }
            continue;
        }
        if (key === 'metadata') {
            if (!emittedFields.metadata && hasInfo.metadata) {
                const metadata = (0, get_metadata_1.getMetadata)(state);
                await ((_v = callbacks.onMetadata) === null || _v === void 0 ? void 0 : _v.call(callbacks, metadata));
                if (fieldsInReturnValue.metadata) {
                    returnValue.metadata = metadata;
                }
                emittedFields.metadata = true;
            }
            continue;
        }
        if (key === 'location') {
            if (!emittedFields.location && hasInfo.location) {
                const location = (0, get_location_1.getLocation)(state);
                await ((_w = callbacks.onLocation) === null || _w === void 0 ? void 0 : _w.call(callbacks, location));
                if (fieldsInReturnValue.location) {
                    returnValue.location = location;
                }
                emittedFields.location = true;
            }
            continue;
        }
        if (key === 'slowKeyframes') {
            if (!emittedFields.slowKeyframes && hasInfo.slowKeyframes) {
                await ((_x = callbacks.onSlowKeyframes) === null || _x === void 0 ? void 0 : _x.call(callbacks, state.keyframes.getKeyframes()));
                if (fieldsInReturnValue.slowKeyframes) {
                    returnValue.slowKeyframes = state.keyframes.getKeyframes();
                }
                emittedFields.slowKeyframes = true;
            }
            continue;
        }
        if (key === 'slowNumberOfFrames') {
            if (!emittedFields.slowNumberOfFrames && hasInfo.slowNumberOfFrames) {
                await ((_y = callbacks.onSlowNumberOfFrames) === null || _y === void 0 ? void 0 : _y.call(callbacks, state.slowDurationAndFps.getSlowNumberOfFrames()));
                if (fieldsInReturnValue.slowNumberOfFrames) {
                    returnValue.slowNumberOfFrames =
                        state.slowDurationAndFps.getSlowNumberOfFrames();
                }
                emittedFields.slowNumberOfFrames = true;
            }
            continue;
        }
        if (key === 'slowAudioBitrate') {
            if (!emittedFields.slowAudioBitrate && hasInfo.slowAudioBitrate) {
                await ((_z = callbacks.onSlowAudioBitrate) === null || _z === void 0 ? void 0 : _z.call(callbacks, state.slowDurationAndFps.getAudioBitrate()));
                if (fieldsInReturnValue.slowAudioBitrate) {
                    returnValue.slowAudioBitrate =
                        state.slowDurationAndFps.getAudioBitrate();
                }
                emittedFields.slowAudioBitrate = true;
            }
            continue;
        }
        if (key === 'slowVideoBitrate') {
            if (!emittedFields.slowVideoBitrate && hasInfo.slowVideoBitrate) {
                await ((_0 = callbacks.onSlowVideoBitrate) === null || _0 === void 0 ? void 0 : _0.call(callbacks, state.slowDurationAndFps.getVideoBitrate()));
                if (fieldsInReturnValue.slowVideoBitrate) {
                    returnValue.slowVideoBitrate =
                        state.slowDurationAndFps.getVideoBitrate();
                }
                emittedFields.slowVideoBitrate = true;
            }
            continue;
        }
        if (key === 'keyframes') {
            if (!emittedFields.keyframes && hasInfo.keyframes) {
                await ((_1 = callbacks.onKeyframes) === null || _1 === void 0 ? void 0 : _1.call(callbacks, (0, get_keyframes_1.getKeyframes)(state)));
                if (fieldsInReturnValue.keyframes) {
                    returnValue.keyframes = (0, get_keyframes_1.getKeyframes)(state);
                }
                emittedFields.keyframes = true;
            }
            continue;
        }
        if (key === 'images') {
            if (!emittedFields.images && hasInfo.images) {
                await ((_2 = callbacks.onImages) === null || _2 === void 0 ? void 0 : _2.call(callbacks, state.images.images));
                if (fieldsInReturnValue.images) {
                    returnValue.images = state.images.images;
                }
                emittedFields.images = true;
            }
            continue;
        }
        if (key === 'sampleRate') {
            if (!emittedFields.sampleRate && hasInfo.sampleRate) {
                const sampleRate = (0, get_sample_rate_1.getSampleRate)(state);
                await ((_3 = callbacks.onSampleRate) === null || _3 === void 0 ? void 0 : _3.call(callbacks, sampleRate));
                if (fieldsInReturnValue.sampleRate) {
                    returnValue.sampleRate = sampleRate;
                }
                emittedFields.sampleRate = true;
            }
            continue;
        }
        if (key === 'numberOfAudioChannels') {
            if (!emittedFields.numberOfAudioChannels &&
                hasInfo.numberOfAudioChannels) {
                const numberOfAudioChannels = (0, get_number_of_audio_channels_1.getNumberOfAudioChannels)(state);
                await ((_4 = callbacks.onNumberOfAudioChannels) === null || _4 === void 0 ? void 0 : _4.call(callbacks, numberOfAudioChannels));
                if (fieldsInReturnValue.numberOfAudioChannels) {
                    returnValue.numberOfAudioChannels = numberOfAudioChannels;
                }
                emittedFields.numberOfAudioChannels = true;
            }
            continue;
        }
        throw new Error(`Unhandled key: ${key}`);
    }
};
exports.emitAvailableInfo = emitAvailableInfo;
