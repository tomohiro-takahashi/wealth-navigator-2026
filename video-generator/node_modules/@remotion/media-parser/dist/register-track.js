"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerVideoTrackWhenProfileIsAvailable = exports.registerTrack = void 0;
const add_avc_profile_to_track_1 = require("./add-avc-profile-to-track");
const log_1 = require("./log");
const registerTrack = async ({ state, track, container, }) => {
    if (state.callbacks.tracks.getTracks().find((t) => t.trackId === track.trackId)) {
        log_1.Log.trace(state.logLevel, `Track ${track.trackId} already registered, skipping`);
        return;
    }
    if (track.type === 'video') {
        state.callbacks.tracks.addTrack(track);
        if (state.onVideoTrack) {
            const callback = await state.onVideoTrack({ track, container });
            await state.callbacks.registerVideoSampleCallback(track.trackId, callback !== null && callback !== void 0 ? callback : null);
        }
    }
    if (track.type === 'audio') {
        state.callbacks.tracks.addTrack(track);
        if (state.onAudioTrack) {
            const callback = await state.onAudioTrack({ track, container });
            await state.callbacks.registerAudioSampleCallback(track.trackId, callback !== null && callback !== void 0 ? callback : null);
        }
    }
};
exports.registerTrack = registerTrack;
const registerVideoTrackWhenProfileIsAvailable = ({ state, track, container, }) => {
    state.riff.registerOnAvcProfileCallback(async (profile) => {
        await (0, exports.registerTrack)({
            state,
            track: (0, add_avc_profile_to_track_1.addAvcProfileToTrack)(track, profile),
            container,
        });
    });
};
exports.registerVideoTrackWhenProfileIsAvailable = registerVideoTrackWhenProfileIsAvailable;
