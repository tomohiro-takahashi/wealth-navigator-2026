"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseTransportStream = void 0;
const parse_packet_1 = require("./parse-packet");
const process_stream_buffers_1 = require("./process-stream-buffers");
const parseTransportStream = async (state) => {
    const structure = state.getTsStructure();
    const { iterator } = state;
    if (iterator.bytesRemaining() < 188) {
        return Promise.resolve(null);
    }
    const packet = await (0, parse_packet_1.parsePacket)({
        parserState: state,
    });
    if (packet) {
        structure.boxes.push(packet);
    }
    if (iterator.bytesRemaining() === 0) {
        await (0, process_stream_buffers_1.processFinalStreamBuffers)({
            state,
            structure,
        });
    }
    return Promise.resolve(null);
};
exports.parseTransportStream = parseTransportStream;
