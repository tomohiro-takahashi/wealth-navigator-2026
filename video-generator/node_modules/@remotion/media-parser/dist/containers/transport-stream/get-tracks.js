"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.hasAllTracksFromTransportStream = exports.getTracksFromTransportStream = void 0;
const truthy_1 = require("../../truthy");
const traversal_1 = require("./traversal");
const getTracksFromTransportStream = (parserState) => {
    const structure = parserState.getTsStructure();
    const programMapTable = (0, traversal_1.findProgramMapTableOrThrow)(structure);
    const parserTracks = parserState.callbacks.tracks.getTracks();
    const mapped = programMapTable.streams
        .map((stream) => {
        return parserTracks.find((track) => track.trackId === stream.pid);
    })
        .filter(truthy_1.truthy);
    if (mapped.length !== programMapTable.streams.length) {
        throw new Error('Not all tracks found');
    }
    return {
        videoTracks: mapped.filter((track) => track.type === 'video'),
        audioTracks: mapped.filter((track) => track.type === 'audio'),
        otherTracks: [],
    };
};
exports.getTracksFromTransportStream = getTracksFromTransportStream;
const hasAllTracksFromTransportStream = (parserState) => {
    try {
        (0, exports.getTracksFromTransportStream)(parserState);
        return true;
    }
    catch (_a) {
        return false;
    }
};
exports.hasAllTracksFromTransportStream = hasAllTracksFromTransportStream;
