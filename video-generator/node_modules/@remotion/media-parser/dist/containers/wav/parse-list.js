"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseList = void 0;
const parseList = ({ state, }) => {
    const { iterator } = state;
    const ckSize = iterator.getUint32Le(); // chunkSize
    const box = iterator.startBox(ckSize);
    const startOffset = iterator.counter.getOffset();
    const type = iterator.getByteString(4, false);
    if (type !== 'INFO') {
        throw new Error(`Only supporting LIST INFO, but got ${type}`);
    }
    const metadata = [];
    while (iterator.counter.getOffset() < startOffset + ckSize) {
        const key = iterator.getByteString(4, false);
        const size = iterator.getUint32Le();
        const value = iterator.getByteString(size, true);
        metadata.push({
            key,
            trackId: null,
            value,
        });
    }
    const wavList = {
        type: 'wav-list',
        metadata,
    };
    state.getWavStructure().boxes.push(wavList);
    box.expectNoMoreBytes();
    return Promise.resolve(null);
};
exports.parseList = parseList;
