"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseRiffBody = void 0;
const skip_1 = require("../../skip");
const may_skip_video_data_1 = require("../../state/may-skip-video-data");
const expect_riff_box_1 = require("./expect-riff-box");
const parse_video_section_1 = require("./parse-video-section");
const parseRiffBody = async (state) => {
    if (state.videoSection.isInVideoSectionState(state.iterator) === 'in-section') {
        if ((0, may_skip_video_data_1.maySkipVideoData)({
            state,
        }) &&
            state.riff.getAvcProfile()) {
            const videoSection = state.videoSection.getVideoSection();
            // only skipping forward in query mode
            return Promise.resolve((0, skip_1.makeSkip)(videoSection.start + videoSection.size));
        }
        await (0, parse_video_section_1.parseVideoSection)(state);
        return null;
    }
    const box = await (0, expect_riff_box_1.expectRiffBox)(state);
    if (box !== null) {
        const structure = state.getRiffStructure();
        structure.boxes.push(box);
    }
    return null;
};
exports.parseRiffBody = parseRiffBody;
